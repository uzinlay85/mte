<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bidirectional Myanmar-English Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Padauk', 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 md:p-8">
        <div class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">အပြန်အလှန် ဘာသာပြန်စက်</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">စာသားရိုက်ထည့်ပြီး "ဘာသာပြန်ရန်" ခလုတ်ကို နှိပ်ပါ။</p>
        </div>

        <!-- API Key Input Section -->
        <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600">
            <label for="api-key-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Gemini API Key</label>
            <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                သင်၏ API Key ကို 
                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="font-semibold text-blue-600 dark:text-blue-400 hover:underline">Google AI Studio</a> 
                တွင် အခမဲ့ ရယူနိုင်ပါသည်။
            </p>
            <div class="flex flex-col sm:flex-row items-center gap-2">
                <input type="password" id="api-key-input" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="သင်၏ API Key ကို ထည့်ပါ">
                <button id="save-key-btn" class="w-full sm:w-auto bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors">Save Key</button>
                <button id="clear-key-btn" class="w-full sm:w-auto bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 transition-colors">Clear Key</button>
            </div>
            <p id="key-status" class="text-xs text-gray-500 dark:text-gray-400 mt-2 h-4"></p>
        </div>

        <!-- Input and Output Textareas -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Myanmar Input -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label for="myanmar-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">မြန်မာစာ</label>
                    <button id="copy-myanmar-btn" class="text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 flex items-center text-sm">
                        <svg id="copy-myanmar-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        <svg id="check-myanmar-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 hidden text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                        <span id="copy-myanmar-text">Copy</span>
                    </button>
                </div>
                <textarea id="myanmar-input" rows="8" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="ဤနေရာတွင် မြန်မာစာ ရိုက်ထည့်ပါ..."></textarea>
            </div>
            <!-- English Output -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label for="english-output" class="block text-sm font-medium text-gray-700 dark:text-gray-300">အင်္ဂလိပ်စာ</label>
                    <div class="flex items-center space-x-4">
                        <button id="listen-btn" class="text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 flex items-center text-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                            <span id="listen-text">နားထောင်ရန်</span>
                        </button>
                        <button id="copy-english-btn" class="text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 flex items-center text-sm">
                            <svg id="copy-english-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            <svg id="check-english-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 hidden text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                            <span id="copy-english-text">Copy</span>
                        </button>
                    </div>
                </div>
                <textarea id="english-output" rows="8" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="... or type English here"></textarea>
            </div>
        </div>

        <!-- Translate Button, Loader and Error Message Box -->
        <div class="mt-6 flex flex-col items-center">
             <button id="translate-btn" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-800 transition-all duration-300 ease-in-out flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 10.586l-2.293-2.293a1 1 0 010-1.414l.707-.707a1 1 0 011.414 0l3.586 3.586a1 1 0 010 1.414l-3.586 3.586a1 1 0 01-1.414-1.414l2.293-2.293zM5 12.586l2.293-2.293a1 1 0 000-1.414l-.707-.707a1 1 0 00-1.414 0L1.414 11.75a1 1 0 000 1.414l3.586 3.586a1 1 0 001.414-1.414L5 12.586z"/></svg>
                ဘာသာပြန်ရန်
            </button>
             <div id="loader" class="loader mt-4 hidden"></div>
             <div id="error-box" class="hidden mt-4 w-full p-4 bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 rounded-lg">
                 <p id="error-message"></p>
             </div>
        </div>

    </div>

    <script>
        // --- DOM Element References ---
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');
        const clearKeyBtn = document.getElementById('clear-key-btn');
        const keyStatus = document.getElementById('key-status');
        const myanmarInput = document.getElementById('myanmar-input');
        const englishOutput = document.getElementById('english-output');
        const translateBtn = document.getElementById('translate-btn');
        
        const copyMyanmarBtn = document.getElementById('copy-myanmar-btn');
        const copyMyanmarText = document.getElementById('copy-myanmar-text');
        const copyMyanmarIcon = document.getElementById('copy-myanmar-icon');
        const checkMyanmarIcon = document.getElementById('check-myanmar-icon');
        
        const copyEnglishBtn = document.getElementById('copy-english-btn');
        const copyEnglishText = document.getElementById('copy-english-text');
        const copyEnglishIcon = document.getElementById('copy-english-icon');
        const checkEnglishIcon = document.getElementById('check-english-icon');
        
        const listenBtn = document.getElementById('listen-btn');
        const listenText = document.getElementById('listen-text');
        const loader = document.getElementById('loader');
        const errorBox = document.getElementById('error-box');
        const errorMessage = document.getElementById('error-message');

        // --- State Variables ---
        let lastActiveInput = 'my'; // To track which input was last used

        // --- Helper Functions ---
        const showLoader = (isLoading) => {
            loader.classList.toggle('hidden', !isLoading);
            translateBtn.disabled = isLoading;
            translateBtn.classList.toggle('opacity-50', isLoading);
        };
        const showError = (message) => {
            errorMessage.textContent = message;
            errorBox.classList.remove('hidden');
        };
        const hideError = () => {
            errorBox.classList.add('hidden');
        };

        // --- API Key Management ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('geminiApiKey');
            if (savedKey) {
                apiKeyInput.value = savedKey;
                keyStatus.textContent = 'Saved API Key loaded.';
                setTimeout(() => keyStatus.textContent = '', 3000);
            }
        });

        saveKeyBtn.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                keyStatus.textContent = 'API Key saved successfully!';
                keyStatus.classList.remove('text-red-500');
                keyStatus.classList.add('text-green-600');
                setTimeout(() => keyStatus.textContent = '', 3000);
            } else {
                keyStatus.textContent = 'Please enter an API Key.';
                keyStatus.classList.add('text-red-500');
            }
        });

        clearKeyBtn.addEventListener('click', () => {
            localStorage.removeItem('geminiApiKey');
            apiKeyInput.value = '';
            keyStatus.textContent = 'API Key cleared.';
            keyStatus.classList.add('text-red-500');
            setTimeout(() => keyStatus.textContent = '', 3000);
        });

        // --- Core Translation Logic ---
        const handleTranslation = async () => {
            const sourceLang = lastActiveInput;
            
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            hideError();
            
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                showError('ကျေးဇူးပြု၍ သင်၏ Gemini API Key ကို ထည့်သွင်းပြီး သိမ်းဆည်းပါ။');
                return;
            }

            let sourceText, targetTextarea, prompt;
            if (sourceLang === 'my') {
                sourceText = myanmarInput.value.trim();
                targetTextarea = englishOutput;
                prompt = `Translate the following Burmese text to simple, clear, and grammatically correct English. Provide only the translated text.\n\nBurmese: "${sourceText}"\n\nEnglish:`;
            } else {
                sourceText = englishOutput.value.trim();
                targetTextarea = myanmarInput;
                prompt = `Translate the following English text to simple, clear, and grammatically correct Burmese. Provide only the translated text.\n\nEnglish: "${sourceText}"\n\nBurmese:`;
            }

            if (!sourceText) {
                showError('ဘာသာပြန်ရန် စာသားထည့်သွင်းပေးပါ။');
                return;
            }

            showLoader(true);

            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status}. ${errorData.error?.message || ''}`);
                }

                const result = await response.json();
                const translatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (translatedText) {
                    targetTextarea.value = translatedText.trim();
                } else {
                    console.error("Unexpected API response structure:", result);
                    showError('ဘာသာပြန်မှု မအောင်မြင်ပါ။ API Key မှန်ကန်မှုရှိမရှိ စစ်ဆေးပါ (သို့) နောက်တစ်ကြိမ် ထပ်ကြိုးစားပါ။');
                }
            } catch (error) {
                console.error('Translation Error:', error);
                showError(`ဘာသာပြန်နေစဉ် အမှားအယွင်းတစ်ခု ဖြစ်ပွားခဲ့သည်။ (${error.message})`);
            } finally {
                showLoader(false);
            }
        };

        // --- Event Listeners ---
        myanmarInput.addEventListener('focus', () => {
            lastActiveInput = 'my';
        });

        englishOutput.addEventListener('focus', () => {
            lastActiveInput = 'en';
        });
        
        translateBtn.addEventListener('click', handleTranslation);

        // Generic copy function
        const copyToClipboard = (text, textElement, iconElement, checkElement) => {
            if (text) {
                navigator.clipboard.writeText(text).then(() => {
                    textElement.textContent = 'ကူးယူပြီးပါပြီ';
                    iconElement.classList.add('hidden');
                    checkElement.classList.remove('hidden');
                    setTimeout(() => {
                        textElement.textContent = 'Copy';
                        iconElement.classList.remove('hidden');
                        checkElement.classList.add('hidden');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    showError('ကူးယူ၍ မရပါ။');
                });
            }
        };
        
        copyMyanmarBtn.addEventListener('click', () => copyToClipboard(myanmarInput.value, copyMyanmarText, copyMyanmarIcon, checkMyanmarIcon));
        copyEnglishBtn.addEventListener('click', () => copyToClipboard(englishOutput.value, copyEnglishText, copyEnglishIcon, checkEnglishIcon));

        listenBtn.addEventListener('click', () => {
            if (!('speechSynthesis' in window)) {
                showError('သင့်ဘရောက်ဆာသည် အသံထွက်ဖတ်ခြင်းကို မထောက်ပံ့ပါ။');
                return;
            }
            const textToSpeak = englishOutput.value.trim();
            if (!textToSpeak) {
                showError('အသံထွက်ဖတ်ရန် စာသားမရှိပါ။');
                return;
            }
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                return;
            }
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'en-US';
            utterance.onstart = () => {
                listenBtn.classList.add('text-blue-600');
                listenText.textContent = 'ရပ်ရန်';
            };
            utterance.onend = () => {
                listenBtn.classList.remove('text-blue-600');
                listenText.textContent = 'နားထောင်ရန်';
            };
            utterance.onerror = (e) => {
                console.error('SpeechSynthesisUtterance.onerror', e);
                showError('အသံထွက်ဖတ်ရာတွင် အမှားအယွင်း ဖြစ်ပွားခဲ့သည်။');
            };
            window.speechSynthesis.speak(utterance);
        });

        window.addEventListener('beforeunload', () => {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
        });
    </script>
</body>
</html>
